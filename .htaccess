# Enable rewrite engine
RewriteEngine On

# Remove all CORS headers from here since they're handled in PHP

# Allow direct access to PHP files in api directory
RewriteCond %{REQUEST_URI} ^/PetFurMe-Application/api/.*\.php$ [NC]
RewriteRule ^ - [L]

# Allow direct access to uploads directory
RewriteCond %{REQUEST_URI} ^/PetFurMe-Application/uploads/.*$ [NC]
RewriteRule ^ - [L]

# All other routes go to React app
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.html [L]

# Add this before the RewriteEngine line
<Files "*.log">
    Order allow,deny
    Deny from all
</Files>

# Make sure PHP files in utils directory are accessible
<Directory "C:/xampp/htdocs/PetFurMe-Application/api/utils">
    Options Indexes FollowSymLinks MultiViews
    AllowOverride All
    Require all granted
    
    # Allow specific PHP files
    <Files "log.php">
        Require all granted
    </Files>
</Directory>

# Protect log files
<FilesMatch "\.(log|txt)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Enable Apache headers module
<IfModule mod_headers.c>
    # Enable CORS for development
    SetEnvIf Origin "http://localhost:8081" AccessControlAllowOrigin=$0
    Header set Access-Control-Allow-Origin %{AccessControlAllowOrigin}e env=AccessControlAllowOrigin
    Header set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE"
    Header set Access-Control-Allow-Headers "Content-Type, Authorization, Accept, X-Requested-With"
    Header set Access-Control-Allow-Credentials "true"

    # Handle OPTIONS method
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
</IfModule>

# Your existing rules... 